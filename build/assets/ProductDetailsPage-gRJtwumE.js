import{r as G,j as e,U as l,M as O,K as R}from"./index-CpoNZy_K.js";import{u}from"./useQuery-CdU9hP8Y.js";import{f as V,a as I,g as Q}from"./ProductService-X_fYFXrO.js";import"./Alert-DmmJ-CO8.js";import"./index-DnNRFRxm.js";import{a as W,C as y,B as d,D}from"./DataTable-Dd0ah6Zu.js";import{B as $}from"./Button-5FPMlk4P.js";import{t as z,N as J}from"./Upload-BWEhbG-n.js";import"./index-DcKY4__E.js";import"./Drawer-YiESGu5W.js";import"./index-2_f4dh3X.js";import"./hoist-non-react-statics.cjs-CSsTDRi9.js";import"./index-UDOHiYwi.js";import"./ScrollBar-Bxslmpi8.js";import{p as X}from"./index-U2oPHaYB.js";import{a as Y,b as Z}from"./index-B_aK2khu.js";import"./index-1G6_mNEt.js";import"./Views-Dk2fMzxD.js";import"./CloseButton-CrGnf40L.js";import"./_getPrototype-DwJTGY_5.js";import"./toString-BjSMy3v_.js";const _=({children:r,defaultValue:n})=>{const[t,i]=G.useState(n);return e.jsx("div",{className:"tabs",children:l.Children.map(r,o=>l.isValidElement(o)?l.cloneElement(o,{activeTab:t,setActiveTab:i}):o)})},ee=({children:r,activeTab:n,setActiveTab:t})=>e.jsx("div",{className:"flex border-b border-gray-200 mb-4",children:l.Children.map(r,i=>l.isValidElement(i)?l.cloneElement(i,{activeTab:n,setActiveTab:t}):i)}),P=({value:r,children:n,activeTab:t,setActiveTab:i})=>e.jsx("button",{className:`px-4 py-2 font-medium text-sm ${t===r?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>i(r),children:n}),T=({value:r,children:n,activeTab:t})=>t===r?e.jsx("div",{className:"py-4",children:n}):null,se=()=>e.jsx("div",{className:"border-t border-gray-200 my-4"}),j=()=>e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx(W,{className:"animate-spin text-2xl text-blue-500"})}),ae={assigned:"bg-blue-500",returned:"bg-emerald-500",lost:"bg-red-500",damaged:"bg-amber-500"},re={excellent:"bg-green-500",good:"bg-blue-500",fair:"bg-yellow-500",poor:"bg-red-500"},Ae=()=>{var b,p,N,f,v,w,S,k,A,K,C,L;const{id:r}=O(),n=R(),{data:t,isLoading:i,error:o}=u({queryKey:["product",r],queryFn:()=>V(r),enabled:!!r,onSuccess:s=>{console.log("Product data response:",s)}}),{data:x,isLoading:B,error:m,refetch:te}=u({queryKey:["product-assignments",r],queryFn:()=>I(r),enabled:!!r}),{data:h,isLoading:H,error:g}=u({queryKey:["product-stock-history",r],queryFn:()=>Q(r),enabled:!!r}),E=[{header:"Employee",accessorKey:"employee",cell:s=>{var c,q;return e.jsxs("span",{children:[((c=s.row.original.employee)==null?void 0:c.name)||"Unknown","(",((q=s.row.original.employee)==null?void 0:q.empId)||"N/A",")"]})}},{header:"Assigned On",accessorKey:"assignedAt",cell:s=>e.jsx("span",{children:new Date(s.row.original.assignedAt).toLocaleDateString()})},{header:"Returned On",accessorKey:"returnedAt",cell:s=>e.jsx("span",{children:s.row.original.returnedAt?new Date(s.row.original.returnedAt).toLocaleDateString():"-"})},{header:"Quantity",accessorKey:"quantity",cell:s=>e.jsx("span",{children:s.row.original.quantity})},{header:"Status",accessorKey:"status",cell:s=>e.jsx(d,{className:ae[s.row.original.status]||"bg-gray-500",children:s.row.original.status})},{header:"Condition",accessorKey:"condition",cell:s=>s.row.original.condition?e.jsx(d,{className:re[s.row.original.condition]||"bg-gray-500",children:s.row.original.condition}):e.jsx("span",{children:"-"})}],F=[{header:"Date",accessorKey:"createdAt",cell:s=>e.jsx("span",{children:new Date(s.row.original.createdAt).toLocaleDateString()})},{header:"User",accessorKey:"user",cell:s=>{var c;return e.jsx("span",{children:((c=s.row.original.user)==null?void 0:c.username)||"System"})}},{header:"Type",accessorKey:"type",cell:s=>e.jsx(d,{children:s.row.original.type})},{header:"Change",accessorKey:"quantity",cell:s=>e.jsxs("span",{className:s.row.original.quantity>0?"text-green-500":"text-red-500",children:[s.row.original.quantity>0?"+":"",s.row.original.quantity]})},{header:"Previous Stock",accessorKey:"previousStock",cell:s=>e.jsx("span",{children:s.row.original.previousStock})},{header:"New Stock",accessorKey:"newStock",cell:s=>e.jsx("span",{children:s.row.original.newStock})},{header:"Notes",accessorKey:"notes",cell:s=>e.jsx("span",{children:s.row.original.notes||"-"})}];if((o||m||g)&&z.push(e.jsx(J,{title:"Error",type:"danger",children:(o==null?void 0:o.message)||(m==null?void 0:m.message)||(g==null?void 0:g.message)||"Failed to load product details"})),i)return e.jsx(j,{});if(!(t!=null&&t.data))return e.jsx("div",{className:"p-4 text-center",children:"Product not found"});const a=t.data,M=typeof a.category=="object"?(b=a.category)==null?void 0:b.name:a.category,U=typeof a.branch=="object"?(p=a.branch)==null?void 0:p.name:a.branch;return console.log("Processed product data:",{...a,categoryName:M,branchName:U}),console.log(" product :",a),e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx($,{className:"mb-4",variant:"plain",icon:e.jsx(X,{}),onClick:()=>n(-1),children:"Back to Products"}),e.jsx(y,{className:"mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:((N=a==null?void 0:a.data)==null?void 0:N.name)||"No name"}),e.jsx("p",{className:"text-gray-600 mb-4",children:((f=a==null?void 0:a.data)==null?void 0:f.model)||"No model"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Serial Number:"}),((v=a==null?void 0:a.data)==null?void 0:v.serialNumber)||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Category:"}),((S=(w=a==null?void 0:a.data)==null?void 0:w.category)==null?void 0:S.name)||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Branch:"}),((A=(k=a==null?void 0:a.data)==null?void 0:k.branch)==null?void 0:A.name)||"-"]}),a.warrantyDate&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Warranty Until:"}),new Date((K=a==null?void 0:a.data)==null?void 0:K.warrantyDate).toLocaleDateString()]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs(d,{className:a.availableStock>0?"bg-emerald-500":"bg-red-500",children:["Stock: ",a.availableStock??0,"/",a.totalStock??0]}),e.jsxs(d,{className:a.complianceStatus?"bg-green-500":"bg-red-500",children:["Compliance: ",a.complianceStatus?"Compliant":"Non-compliant"]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Notes"}),e.jsx("p",{className:"text-gray-600",children:a.notes||"No notes available"})]})]})]})}),e.jsx(se,{}),e.jsxs(_,{defaultValue:"assignments",children:[e.jsxs(ee,{children:[e.jsx(P,{value:"assignments",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{})," Assignments"]})}),e.jsx(P,{value:"history",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{})," Stock History"]})})]}),e.jsxs(T,{value:"assignments",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Assignment History"}),e.jsx("p",{className:"text-gray-500",children:"All assignments for this product"})]}),B?e.jsx(j,{}):e.jsx(y,{children:e.jsx(D,{columns:E,data:((C=x==null?void 0:x.data)==null?void 0:C.data)||[]})})]}),e.jsxs(T,{value:"history",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Stock History"}),e.jsx("p",{className:"text-gray-500",children:"All stock changes for this product"})]}),H?e.jsx(j,{}):e.jsx(y,{children:e.jsx(D,{columns:F,data:((L=h==null?void 0:h.data)==null?void 0:L.data)||[]})})]})]})]})};export{Ae as default};
