import{Q as H,K as J,T as X,j as e}from"./index-BTvfn8c6.js";import{F as Y,a as s}from"./Alert-vY0LSn8E.js";import{B as c}from"./Button-ZOmEEmWf.js";import{F as Z,c as _,a as V,b as x,e as G,d as K}from"./index.esm-BFJwpDHv.js";import"./index-DrMltTCj.js";import"./Badge-BvMIftRM.js";import{a as R,t as Q,N as A}from"./Upload-B5EJ-QdQ.js";import{C as ee}from"./index-B8ZftT__.js";import"./Drawer-BB0eFAGt.js";import"./index-DLYq64dO.js";import{I as T}from"./hoist-non-react-statics.cjs-7QXkVKXm.js";import"./index-CYej4EnW.js";import{S as y}from"./DataTable-6RCwsUpc.js";import"./Progress-DNVzeDE3.js";import"./ScrollBar-D7_TsneS.js";import{A as ae}from"./AdaptableCard-BpOmVb2l.js";import"./Views-CJ6KUMaV.js";import"./chart.config-DAFIsZQa.js";import"./SvgIcon-DQO28BJW.js";import{g as te,f as re}from"./ProductService-BoDmucCl.js";import{a as ne}from"./CategoryService-i9qYz419.js";import{a as de}from"./BranchService-DGBaef1X.js";import{a as oe}from"./DepartmentService-D5KYnEFv.js";import{u as p}from"./useQuery-DgMmMGS9.js";import{u as ie}from"./useMutation-B3D-2MId.js";import{C as se}from"./ClipLoader-DMEpPbxs.js";import"./toString-BZKBz3l6.js";import"./proxy-yAAJyhxI.js";import"./CloseButton-q8NuGXO0.js";import"./cloneDeep-DJN0yfLA.js";import"./_getPrototype-BSvN2cSG.js";import"./index-Chjiymov.js";import"./useThemeClass-BfVIhGrM.js";const le=_().shape({name:K().required("Product name is required").min(2,"Too Short!").max(100,"Too Long!"),model:K().required("Model is required"),categoryId:G().required("Category is required"),branchId:G().required("Branch is required")}),ze=()=>{var v;const{id:l}=H(),m=J(),b=X(),{data:d,isLoading:U,error:$,isError:z}=p({queryKey:["product",l],queryFn:()=>re(Number(l)),enabled:!!l,retry:!1}),{data:u,isLoading:f,error:j}=p({queryKey:["categories"],queryFn:()=>ne({page:1,limit:100})}),{data:g,isLoading:I,error:S}=p({queryKey:["branches"],queryFn:()=>de({page:1,limit:100})}),{data:h,isLoading:C,error:N}=p({queryKey:["departments"],queryFn:()=>oe({page:1,limit:100})}),q=ie({mutationFn:a=>te(Number(l),a),onSuccess:()=>{b.invalidateQueries(["product",l]),b.invalidateQueries(["products"]),Q.push(e.jsx(A,{title:"Success",type:"success",children:"Product updated successfully"})),m("/products")},onError:a=>{var o,r;console.error("Update error:",a);let n="Failed to update product";(r=(o=a.response)==null?void 0:o.data)!=null&&r.message?n=a.response.data.message:a.message&&(n=a.message),Q.push(e.jsx(A,{title:"Error",type:"danger",children:n}))}}),O=async(a,{setSubmitting:n})=>{var r;const o={name:a.name.trim(),model:a.model.trim(),categoryId:Number(a.categoryId),branchId:Number(a.branchId),departmentId:a.departmentId?Number(a.departmentId):null,warrantyDate:a.warrantyDate||null,complianceStatus:!!a.complianceStatus,notes:((r=a.notes)==null?void 0:r.trim())||null};q.mutate(o),n(!1)},W=()=>{var n,o,r,i;if(!((n=d==null?void 0:d.data)!=null&&n.data))return{name:"",model:"",categoryId:"",branchId:"",departmentId:"",warrantyDate:null,complianceStatus:!1,notes:""};const a=d.data.data;return{name:a.name||"",model:a.model||"",categoryId:((o=a.categoryId)==null?void 0:o.toString())||"",branchId:((r=a.branchId)==null?void 0:r.toString())||"",departmentId:((i=a.departmentId)==null?void 0:i.toString())||"",warrantyDate:a.warrantyDate?new Date(a.warrantyDate):null,complianceStatus:a.complianceStatus||!1,notes:a.notes||""}};return U?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(se,{color:"#3B82F6",size:40})}):z?e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4 p-4 bg-red-50 text-red-600 rounded",children:["Error loading product: ",$.message]}),e.jsx(c,{onClick:()=>m(-1),children:"Go Back"})]}):(v=d==null?void 0:d.data)!=null&&v.data?e.jsxs(ae,{className:"h-full",bodyClass:"h-full",children:[e.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:e.jsxs("h3",{children:["Edit Product: ",d.data.data.name]})}),e.jsx(Z,{initialValues:W(),validationSchema:le,onSubmit:O,enableReinitialize:!0,children:({touched:a,errors:n,isSubmitting:o,values:r,setFieldValue:i})=>{var F,P,E,B,M,k;const w=((F=u==null?void 0:u.data)==null?void 0:F.data)||[],D=((P=g==null?void 0:g.data)==null?void 0:P.data)||[],L=((E=h==null?void 0:h.data)==null?void 0:E.data)||[];return e.jsx(V,{children:e.jsxs(Y,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(s,{label:"Product Name",invalid:!!n.name&&a.name,errorMessage:n.name,children:e.jsx(x,{type:"text",autoComplete:"off",name:"name",placeholder:"Product name",component:T})}),e.jsx(s,{label:"Model",invalid:!!n.model&&a.model,errorMessage:n.model,children:e.jsx(x,{type:"text",autoComplete:"off",name:"model",placeholder:"Model",component:T})}),e.jsxs(s,{label:"Category",invalid:!!n.categoryId&&a.categoryId,errorMessage:n.categoryId,children:[e.jsx(y,{placeholder:f?"Loading...":"Select Category",loading:f,options:w.map(t=>({value:t.id.toString(),label:t.name})),value:r.categoryId?{value:r.categoryId,label:(B=w.find(t=>t.id.toString()===r.categoryId))==null?void 0:B.name}:null,onChange:t=>i("categoryId",t==null?void 0:t.value)}),j&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load categories: ",j.message]})]}),e.jsxs(s,{label:"Branch",invalid:!!n.branchId&&a.branchId,errorMessage:n.branchId,children:[e.jsx(y,{placeholder:I?"Loading...":"Select Branch",loading:I,options:D.map(t=>({value:t.id.toString(),label:t.name})),value:r.branchId?{value:r.branchId,label:(M=D.find(t=>t.id.toString()===r.branchId))==null?void 0:M.name}:null,onChange:t=>i("branchId",t==null?void 0:t.value)}),S&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load branches: ",S.message]})]}),e.jsxs(s,{label:"Department",children:[e.jsx(y,{placeholder:C?"Loading...":"Select Department (Optional)",loading:C,options:L.map(t=>({value:t.id.toString(),label:t.name})),value:r.departmentId?{value:r.departmentId,label:(k=L.find(t=>t.id.toString()===r.departmentId))==null?void 0:k.name}:null,onChange:t=>i("departmentId",t==null?void 0:t.value),isClearable:!0}),N&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load departments: ",N.message]})]}),e.jsx(s,{label:"Warranty Date",children:e.jsx(R,{placeholder:"Select warranty date",value:r.warrantyDate,onChange:t=>i("warrantyDate",t)})}),e.jsx(s,{label:"Compliance Status",children:e.jsx(ee,{name:"complianceStatus",checked:r.complianceStatus,onChange:t=>i("complianceStatus",t),children:"Compliant"})}),e.jsx(s,{label:"Notes",children:e.jsx(x,{as:"textarea",name:"notes",placeholder:"Additional notes",className:"w-full h-20 p-2 border rounded"})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(c,{type:"button",onClick:()=>m(-1),children:"Cancel"}),e.jsx(c,{variant:"solid",type:"submit",loading:o||q.isLoading,children:"Update Product"})]})]})})}},d.data.data.id)]}):e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-4 p-4 bg-yellow-50 text-yellow-600 rounded",children:"Product not found"}),e.jsx(c,{onClick:()=>m(-1),children:"Go Back"})]})};export{ze as default};
