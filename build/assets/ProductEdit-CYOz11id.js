import{Q as H,K as J,T as X,j as e}from"./index-cOqvBBIr.js";import{F as Y,a as s}from"./Alert-CTDsJo34.js";import{B as c}from"./Button-DwOByDJ2.js";import{F as Z,c as _,a as V,b as x,e as G,d as K}from"./index.esm-1_ITS87e.js";import"./index-C8lJW4Vi.js";import"./Card-DIGZvD7G.js";import{a as R,t as Q,N as A}from"./Upload-DsbizeeT.js";import{C as ee}from"./index-CBL9JDNu.js";import"./Drawer-u9YseTV0.js";import"./index-BmFHComS.js";import{I as T}from"./hoist-non-react-statics.cjs-B9oDFgJF.js";import"./index-Dgezmd6G.js";import{S as y}from"./index-CN4Vsls-.js";import"./Progress-CRnRERH5.js";import"./ScrollBar-CJQ4FW-3.js";import{A as ae}from"./AdaptableCard-BVmYyrG9.js";import"./Views-CoZ6zsbe.js";import"./chart.config-CfHsf3bG.js";import"./DataTable-CPwywcbC.js";import"./SvgIcon-D-q3lrIO.js";import{g as te,f as re}from"./ProductService-JlHD3oXb.js";import{a as de}from"./CategoryService-BNZLqjMy.js";import{a as ne}from"./BranchService-CyZTryOu.js";import{a as ie}from"./DepartmentService-D931eJra.js";import{u as p}from"./useQuery-DfbZlmc7.js";import{u as oe}from"./useMutation-C6r5hGln.js";import{C as se}from"./ClipLoader-Dev_y_P4.js";import"./toString-R3Kz-oVC.js";import"./proxy-CuIDo5Hh.js";import"./CloseButton-DwYxsUt0.js";import"./cloneDeep-DJN0yfLA.js";import"./_getPrototype-DsJNHg3O.js";import"./index-Chjiymov.js";import"./useThemeClass-CybD-6cM.js";const le=_().shape({name:K().required("Product name is required").min(2,"Too Short!").max(100,"Too Long!"),model:K().required("Model is required"),categoryId:G().required("Category is required"),branchId:G().required("Branch is required")}),We=()=>{var q;const{id:l}=H(),m=J(),b=X(),{data:n,isLoading:U,error:$,isError:z,isSuccess:me}=p({queryKey:["product",l],queryFn:()=>re(Number(l)),enabled:!!l,retry:!1}),{data:u,isLoading:f,error:j}=p({queryKey:["categories"],queryFn:()=>de({page:1,limit:100})}),{data:h,isLoading:I,error:C}=p({queryKey:["branches"],queryFn:()=>ne({page:1,limit:100})}),{data:g,isLoading:N,error:S}=p({queryKey:["departments"],queryFn:()=>ie({page:1,limit:100})}),v=oe({mutationFn:a=>te(Number(l),a),onSuccess:()=>{b.invalidateQueries(["product",l]),b.invalidateQueries(["products"]),Q.push(e.jsx(A,{title:"Success",type:"success",children:"Product updated successfully"})),m("/products")},onError:a=>{var i,r;console.error("Update error:",a);let d="Failed to update product";(r=(i=a.response)==null?void 0:i.data)!=null&&r.message?d=a.response.data.message:a.message&&(d=a.message),Q.push(e.jsx(A,{title:"Error",type:"danger",children:d}))}}),O=async(a,{setSubmitting:d})=>{var r;const i={name:a.name.trim(),model:a.model.trim(),categoryId:Number(a.categoryId),branchId:Number(a.branchId),departmentId:a.departmentId?Number(a.departmentId):void 0,warrantyDate:a.warrantyDate||void 0,complianceStatus:!!a.complianceStatus,notes:((r=a.notes)==null?void 0:r.trim())||void 0};v.mutate(i),d(!1)},W=()=>{var d,i,r,o;if(!((d=n==null?void 0:n.data)!=null&&d.data))return{name:"",model:"",categoryId:"",branchId:"",departmentId:"",warrantyDate:null,complianceStatus:!1,notes:""};const a=n.data.data;return{name:a.name||"",model:a.model||"",categoryId:((i=a.category)==null?void 0:i.id)||"",branchId:((r=a.branch)==null?void 0:r.id)||"",departmentId:((o=a.department)==null?void 0:o.id)||"",warrantyDate:a.warrantyDate?new Date(a.warrantyDate):null,complianceStatus:a.complianceStatus||!1,notes:a.notes||""}};return U?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(se,{color:"#3B82F6",size:40})}):z?e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4 p-4 bg-red-50 text-red-600 rounded",children:["Error loading product: ",$.message]}),e.jsx(c,{onClick:()=>m(-1),children:"Go Back"})]}):(q=n==null?void 0:n.data)!=null&&q.data?e.jsxs(ae,{className:"h-full",bodyClass:"h-full",children:[e.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:e.jsxs("h3",{children:["Edit Product: ",n.data.data.name]})}),e.jsx(Z,{initialValues:W(),validationSchema:le,onSubmit:O,enableReinitialize:!0,children:({touched:a,errors:d,isSubmitting:i,values:r,setFieldValue:o})=>{var P,F,E,B,M,k;const w=((P=u==null?void 0:u.data)==null?void 0:P.data)||[],D=((F=h==null?void 0:h.data)==null?void 0:F.data)||[],L=((E=g==null?void 0:g.data)==null?void 0:E.data)||[];return e.jsx(V,{children:e.jsxs(Y,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(s,{label:"Product Name",invalid:!!d.name&&a.name,errorMessage:d.name,children:e.jsx(x,{type:"text",autoComplete:"off",name:"name",placeholder:"Product name",component:T})}),e.jsx(s,{label:"Model",invalid:!!d.model&&a.model,errorMessage:d.model,children:e.jsx(x,{type:"text",autoComplete:"off",name:"model",placeholder:"Model",component:T})}),e.jsxs(s,{label:"Category",invalid:!!d.categoryId&&a.categoryId,errorMessage:d.categoryId,children:[e.jsx(y,{placeholder:f?"Loading...":"Select Category",loading:f,options:w.map(t=>({value:t.id,label:t.name})),value:r.categoryId?{value:r.categoryId,label:(B=w.find(t=>t.id===Number(r.categoryId)))==null?void 0:B.name}:null,onChange:t=>o("categoryId",t==null?void 0:t.value)}),j&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load categories: ",j.message]})]}),e.jsxs(s,{label:"Branch",invalid:!!d.branchId&&a.branchId,errorMessage:d.branchId,children:[e.jsx(y,{placeholder:I?"Loading...":"Select Branch",loading:I,options:D.map(t=>({value:t.id,label:t.name})),value:r.branchId?{value:r.branchId,label:(M=D.find(t=>t.id===Number(r.branchId)))==null?void 0:M.name}:null,onChange:t=>o("branchId",t==null?void 0:t.value)}),C&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load branches: ",C.message]})]}),e.jsxs(s,{label:"Department",children:[e.jsx(y,{placeholder:N?"Loading...":"Select Department (Optional)",loading:N,options:L.map(t=>({value:t.id,label:t.name})),value:r.departmentId?{value:r.departmentId,label:(k=L.find(t=>t.id===Number(r.departmentId)))==null?void 0:k.name}:null,onChange:t=>o("departmentId",t==null?void 0:t.value),isClearable:!0}),S&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load departments: ",S.message]})]}),e.jsx(s,{label:"Warranty Date",children:e.jsx(R,{placeholder:"Select warranty date",value:r.warrantyDate,onChange:t=>o("warrantyDate",t)})}),e.jsx(s,{label:"Compliance Status",children:e.jsx(ee,{name:"complianceStatus",checked:r.complianceStatus,onChange:t=>o("complianceStatus",t),children:"Compliant"})}),e.jsx(s,{label:"Notes",children:e.jsx(x,{as:"textarea",name:"notes",placeholder:"Additional notes",className:"w-full h-20 p-2 border rounded"})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(c,{type:"button",onClick:()=>m(-1),children:"Cancel"}),e.jsx(c,{variant:"solid",type:"submit",loading:i||v.isLoading,children:"Update Product"})]})]})})}},n.data.data.id)]}):e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-4 p-4 bg-yellow-50 text-yellow-600 rounded",children:"Product not found"}),e.jsx(c,{onClick:()=>m(-1),children:"Go Back"})]})};export{We as default};
