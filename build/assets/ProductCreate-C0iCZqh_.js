import{K as w,j as e}from"./index-CpoNZy_K.js";import{F as B,a as l}from"./Alert-DmmJ-CO8.js";import{B as q}from"./Button-5FPMlk4P.js";import{F as L,c as E,a as T,b as d,d as c,e as _}from"./index.esm-CUjMKeau.js";import"./index-DnNRFRxm.js";import{S as k}from"./DataTable-Dd0ah6Zu.js";import{t as v,N as F}from"./Upload-BWEhbG-n.js";import"./index-DcKY4__E.js";import"./Drawer-YiESGu5W.js";import"./index-2_f4dh3X.js";import{I as p}from"./hoist-non-react-statics.cjs-CSsTDRi9.js";import"./index-UDOHiYwi.js";import"./ScrollBar-Bxslmpi8.js";import{A as I}from"./AdaptableCard-BrRUUEaN.js";import"./Views-Dk2fMzxD.js";import"./SvgIcon-CF7LUJah.js";import{e as K}from"./ProductService-X_fYFXrO.js";import{u as M}from"./useQuery-CdU9hP8Y.js";import{a as $}from"./CategoryService-D8iSSJjL.js";import{a as A}from"./BranchService-BUmbyp41.js";import"./index-1G6_mNEt.js";import"./index-U2oPHaYB.js";import"./CloseButton-CrGnf40L.js";import"./cloneDeep-DgnTTuDI.js";import"./_getPrototype-DwJTGY_5.js";import"./toString-BjSMy3v_.js";import"./useThemeClass-BqZMVik2.js";const G=E().shape({name:c().required("Product name is required").min(2,"Too Short!").max(100,"Too Long!"),model:c().required("Model is required"),serialNumber:c().required("Serial number is required"),category:c().required("Category is required"),totalStock:_().required("Total stock is required").min(1,"Must be at least 1"),branch:c().required("Branch is required")}),ge=()=>{const h=w(),{data:u,isLoading:b,error:y}=M({queryKey:["categories"],queryFn:()=>$({page:1,limit:100})}),{data:g,isLoading:x,error:f}=M({queryKey:["branches"],queryFn:()=>A({page:1,limit:100})}),P=async(a,{setSubmitting:t})=>{var m,i,n;t(!0);try{const o={name:a.name.trim(),model:a.model.trim(),serialNumber:a.serialNumber.trim(),category:a.category,branch:a.branch,totalStock:Number(a.totalStock),availableStock:Number(a.totalStock),warrantyDate:a.warrantyDate||void 0,complianceStatus:!!a.complianceStatus,notes:((m=a.notes)==null?void 0:m.trim())||void 0};console.log("Submitting product:",o);const s=await K(o);if(s.success)v.push(e.jsx(F,{title:"Success",type:"success",children:"Product created successfully"})),h("/products");else throw new Error(s.message||"Failed to create product")}catch(o){console.error("Product creation error:",o);let s="Failed to create product";(n=(i=o.response)==null?void 0:i.data)!=null&&n.message?s=o.response.data.message:o.message&&(s=o.message),v.push(e.jsx(F,{title:"Error",type:"danger",children:s}))}finally{t(!1)}};return e.jsxs(I,{className:"h-full",bodyClass:"h-full",children:[e.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:e.jsx("h3",{children:"Create New Product"})}),e.jsx(L,{initialValues:{name:"",model:"",serialNumber:"",category:"",totalStock:1,branch:"",warrantyDate:null,complianceStatus:!1,notes:""},validationSchema:G,onSubmit:P,children:({touched:a,errors:t,isSubmitting:m,values:i,setFieldValue:n})=>{var j,S,N,C;const o=((j=u==null?void 0:u.data)==null?void 0:j.data)||[],s=((S=g==null?void 0:g.data)==null?void 0:S.data)||[];return e.jsx(T,{children:e.jsxs(B,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{label:"Product Name",invalid:!!t.name&&a.name,errorMessage:t.name,children:e.jsx(d,{type:"text",autoComplete:"off",name:"name",placeholder:"Product name",component:p})}),e.jsx(l,{label:"Model",invalid:!!t.model&&a.model,errorMessage:t.model,children:e.jsx(d,{type:"text",autoComplete:"off",name:"model",placeholder:"Model",component:p})}),e.jsx(l,{label:"Serial Number",invalid:!!t.serialNumber&&a.serialNumber,errorMessage:t.serialNumber,children:e.jsx(d,{type:"text",autoComplete:"off",name:"serialNumber",placeholder:"Serial number",component:p})}),e.jsxs(l,{label:"Category",invalid:!!t.category&&a.category,errorMessage:t.category,children:[e.jsx(k,{placeholder:b?"Loading...":"Select Category",loading:b,options:o.map(r=>({value:r._id,label:r.name})),value:i.category?{value:i.category,label:(N=o.find(r=>r._id===i.category))==null?void 0:N.name}:null,onChange:r=>n("category",r==null?void 0:r.value)}),y&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load categories: ",y.message]})]}),e.jsx(l,{label:"Total Stock",invalid:!!t.totalStock&&a.totalStock,errorMessage:t.totalStock,children:e.jsx(d,{type:"number",autoComplete:"off",name:"totalStock",placeholder:"Total stock",component:p,min:1})}),e.jsxs(l,{label:"Branch",invalid:!!t.branch&&a.branch,errorMessage:t.branch,children:[e.jsx(k,{placeholder:x?"Loading...":"Select Branch",loading:x,options:s.map(r=>({value:r._id,label:r.name})),value:i.branch?{value:i.branch,label:(C=s.find(r=>r._id===i.branch))==null?void 0:C.name}:null,onChange:r=>n("branch",r==null?void 0:r.value)}),f&&e.jsxs("div",{className:"text-red-500 text-sm mt-1",children:["Failed to load branches: ",f.message]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(q,{type:"button",onClick:()=>h(-1),children:"Cancel"}),e.jsx(q,{variant:"solid",type:"submit",loading:m,children:"Create Product"})]})]})})}})]})};export{ge as default};
