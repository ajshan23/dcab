import{M as D,K as B,r as h,j as a}from"./index-CpoNZy_K.js";import{F as E,a as l}from"./Alert-DmmJ-CO8.js";import{B as C}from"./Button-5FPMlk4P.js";import{F,c as T,a as A,b as s,e as f,d as x}from"./index.esm-CUjMKeau.js";import"./index-DnNRFRxm.js";import{S as N}from"./DataTable-Dd0ah6Zu.js";import{a as G,t as b,N as g}from"./Upload-BWEhbG-n.js";import{C as L}from"./index-DcKY4__E.js";import"./Drawer-YiESGu5W.js";import"./index-2_f4dh3X.js";import{I as p}from"./hoist-non-react-statics.cjs-CSsTDRi9.js";import"./index-UDOHiYwi.js";import"./ScrollBar-Bxslmpi8.js";import{A as $}from"./AdaptableCard-BrRUUEaN.js";import"./Views-Dk2fMzxD.js";import"./SvgIcon-CF7LUJah.js";import{f as R,h as U}from"./ProductService-X_fYFXrO.js";import{u as v}from"./useQuery-CdU9hP8Y.js";import{a as z}from"./CategoryService-D8iSSJjL.js";import{a as K}from"./BranchService-BUmbyp41.js";import"./index-1G6_mNEt.js";import"./index-U2oPHaYB.js";import"./CloseButton-CrGnf40L.js";import"./cloneDeep-DgnTTuDI.js";import"./_getPrototype-DwJTGY_5.js";import"./toString-BjSMy3v_.js";import"./useThemeClass-BqZMVik2.js";const Q=T().shape({name:x().required("Product name is required").min(2,"Too Short!").max(100,"Too Long!"),model:x().required("Model is required"),serialNumber:x().required("Serial number is required"),categoryId:f().required("Category is required"),totalStock:f().required("Total stock is required").min(1,"Must be at least 1"),branchId:f().required("Branch is required")}),ga=()=>{const{id:n}=D(),c=B(),{data:o}=v(["categories"],()=>z({page:1,limit:100})),{data:d}=v(["branches"],()=>K({page:1,limit:100})),[k,M]=h.useState({name:"",model:"",serialNumber:"",categoryId:"",totalStock:1,branchId:"",warrantyDate:null,complianceStatus:!1,notes:""}),[w,P]=h.useState(!0);h.useEffect(()=>{n&&(async()=>{try{const e=await R(n);M({name:e.data.data.name,model:e.data.data.model,serialNumber:e.data.data.serialNumber,categoryId:e.data.data.categoryId,totalStock:e.data.data.totalStock,branchId:e.data.data.branchId,warrantyDate:e.data.data.warrantyDate||null,complianceStatus:e.data.data.complianceStatus||!1,notes:e.data.data.notes||""}),P(!1)}catch(e){b.push(a.jsx(g,{title:"Error",type:"danger",children:e.message||"Failed to fetch product"})),c("/products")}})()},[n,c]);const q=async(r,{setSubmitting:e})=>{try{(await U(n,r)).status===200&&(b.push(a.jsx(g,{title:"Success",type:"success",children:"Product updated successfully"})),c("/products"))}catch(m){b.push(a.jsx(g,{title:"Error",type:"danger",children:m.message||"Failed to update product"}))}finally{e(!1)}};return w?a.jsx("div",{className:"flex h-full items-center justify-center",children:a.jsx("h3",{className:"text-gray-500",children:"Loading product details..."})}):a.jsxs($,{className:"h-full",bodyClass:"h-full",children:[a.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:a.jsx("h3",{children:"Edit Product"})}),a.jsx(F,{initialValues:k,validationSchema:Q,onSubmit:q,enableReinitialize:!0,children:({touched:r,errors:e,isSubmitting:m,values:i,setFieldValue:u})=>{var y,j,S,I;return a.jsx(A,{children:a.jsxs(E,{children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(l,{label:"Product Name",invalid:!!e.name&&r.name,errorMessage:e.name,children:a.jsx(s,{type:"text",autoComplete:"off",name:"name",placeholder:"Product name",component:p})}),a.jsx(l,{label:"Model",invalid:!!e.model&&r.model,errorMessage:e.model,children:a.jsx(s,{type:"text",autoComplete:"off",name:"model",placeholder:"Model",component:p})}),a.jsx(l,{label:"Serial Number",invalid:!!e.serialNumber&&r.serialNumber,errorMessage:e.serialNumber,children:a.jsx(s,{type:"text",autoComplete:"off",name:"serialNumber",placeholder:"Serial number",component:p})}),a.jsx(l,{label:"Category",invalid:!!e.categoryId&&r.categoryId,errorMessage:e.categoryId,children:a.jsx(N,{placeholder:"Select Category",options:((y=o==null?void 0:o.data)==null?void 0:y.data.map(t=>({value:t.id,label:t.name})))||[],value:(j=o==null?void 0:o.data)!=null&&j.data.find(t=>t.id===i.categoryId)?{value:i.categoryId,label:o.data.data.find(t=>t.id===i.categoryId).name}:null,onChange:t=>u("categoryId",t==null?void 0:t.value)})}),a.jsx(l,{label:"Total Stock",invalid:!!e.totalStock&&r.totalStock,errorMessage:e.totalStock,children:a.jsx(s,{type:"number",autoComplete:"off",name:"totalStock",placeholder:"Total stock",component:p})}),a.jsx(l,{label:"Branch",invalid:!!e.branchId&&r.branchId,errorMessage:e.branchId,children:a.jsx(N,{placeholder:"Select Branch",options:((S=d==null?void 0:d.data)==null?void 0:S.data.map(t=>({value:t.id,label:t.name})))||[],value:(I=d==null?void 0:d.data)!=null&&I.data.find(t=>t.id===i.branchId)?{value:i.branchId,label:d.data.data.find(t=>t.id===i.branchId).name}:null,onChange:t=>u("branchId",t==null?void 0:t.value)})}),a.jsx(l,{label:"Warranty Date",invalid:!!e.warrantyDate&&r.warrantyDate,errorMessage:e.warrantyDate,children:a.jsx(G,{placeholder:"Select warranty date",value:i.warrantyDate,onChange:t=>u("warrantyDate",t)})}),a.jsx(l,{label:"Compliance Status",invalid:!!e.complianceStatus&&r.complianceStatus,errorMessage:e.complianceStatus,children:a.jsx(L,{name:"complianceStatus",checked:i.complianceStatus,onChange:t=>u("complianceStatus",t),children:"Compliant"})}),a.jsx(l,{label:"Notes",invalid:!!e.notes&&r.notes,errorMessage:e.notes,children:a.jsx(s,{as:"textarea",name:"notes",placeholder:"Additional notes",className:"w-full h-20 p-2 border rounded"})})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[a.jsx(C,{type:"button",onClick:()=>c(-1),children:"Cancel"}),a.jsx(C,{variant:"solid",type:"submit",loading:m,children:"Update Product"})]})]})})}})]})};export{ga as default};
