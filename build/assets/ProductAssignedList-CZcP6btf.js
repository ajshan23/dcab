import{r as a,K as O,T as k,j as t}from"./index-cOqvBBIr.js";import{A as E}from"./AdaptableCard-BVmYyrG9.js";import"./Views-CoZ6zsbe.js";import{B as P}from"./Card-DIGZvD7G.js";import"./chart.config-CfHsf3bG.js";import"./index-C8lJW4Vi.js";import{B as r}from"./Button-DwOByDJ2.js";import{t as L,N as B,D as I}from"./Upload-DsbizeeT.js";import{D as T}from"./DataTable-CPwywcbC.js";import{I as F}from"./hoist-non-react-statics.cjs-B9oDFgJF.js";import"./SvgIcon-D-q3lrIO.js";import{S as M}from"./index-CN4Vsls-.js";import{s as G,x as q,y as z}from"./proxy-CuIDo5Hh.js";import{u as H}from"./useQuery-DfbZlmc7.js";import{u as Q}from"./useMutation-C6r5hGln.js";import{d as K}from"./debounce-ENV5vHzm.js";import{b as $,h as U}from"./ProductService-JlHD3oXb.js";import"./Alert-CTDsJo34.js";import"./index-CBL9JDNu.js";import"./Drawer-u9YseTV0.js";import"./index-BmFHComS.js";import"./index-Dgezmd6G.js";import"./Progress-CRnRERH5.js";import"./ScrollBar-CJQ4FW-3.js";import{M as X}from"./index-DJ2xx_vj.js";import"./index-Chjiymov.js";import"./toString-R3Kz-oVC.js";import"./CloseButton-DwYxsUt0.js";import"./cloneDeep-DJN0yfLA.js";import"./useThemeClass-CybD-6cM.js";import"./_getPrototype-DsJNHg3O.js";const J=()=>{var h,x,f;const b=a.useRef(null),u=O(),v=k(),[N,C]=a.useState(""),[o,c]=a.useState({page:1,limit:10}),[s,d]=a.useState({open:!1,assignment:null,condition:"GOOD"}),{data:n,isLoading:y,error:p,refetch:w}=H({queryKey:["active-assignments",o,N],queryFn:()=>U({page:o.page,limit:o.limit})}),g=Q({mutationFn:e=>$(e.assignmentId,{condition:e.condition,notes:e.notes}),onSuccess:()=>{m("Product returned successfully","success"),v.invalidateQueries(["active-assignments"]),l()},onError:e=>{var i,j;m(((j=(i=e.response)==null?void 0:i.data)==null?void 0:j.message)||"Failed to return product","danger")}}),m=(e,i)=>{L.push(t.jsx(B,{title:i==="success"?"Success":"Error",type:i,children:e}))},A=a.useMemo(()=>K(e=>{C(e),c(i=>({...i,page:1}))},500),[]),l=()=>{d({open:!1,assignment:null,condition:"GOOD"})},R=e=>{d({...s,open:!0,assignment:{id:e.id,productName:e.product.name}})},S=async()=>{var e;if(!((e=s.assignment)!=null&&e.id)){m("No valid assignment selected","danger");return}await g.mutateAsync({assignmentId:s.assignment.id,condition:s.condition,notes:`Returned in ${s.condition.toLowerCase()} condition`})},D=a.useMemo(()=>[{header:"Product",cell:e=>t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold block",children:e.row.original.product.name}),t.jsx("span",{className:"text-xs text-gray-500",children:e.row.original.product.model})]})},{header:"Category",cell:e=>e.row.original.product.category.name},{header:"Branch",cell:e=>e.row.original.product.branch.name},{header:"Assigned To",cell:e=>t.jsxs("div",{children:[t.jsx("span",{className:"block",children:e.row.original.employee.name}),t.jsx("span",{className:"text-xs text-gray-500",children:e.row.original.employee.empId})]})},{header:"Assigned By",cell:e=>e.row.original.assignedBy.username},{header:"Assigned At",cell:e=>new Date(e.row.original.assignedAt).toLocaleDateString()},{header:"Expected Return",cell:e=>e.row.original.expectedReturnAt?new Date(e.row.original.expectedReturnAt).toLocaleDateString():"-"},{header:"Status",cell:e=>t.jsx(P,{className:"w-fit bg-blue-500 text-white",children:"Assigned"})},{header:"Actions",id:"action",cell:e=>{const i=e.row.original;return t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(r,{size:"xs",icon:t.jsx(G,{}),onClick:()=>u(`/products/view/${i.product.id}`)}),t.jsx(r,{size:"xs",variant:"solid",icon:t.jsx(X,{}),onClick:()=>R(i),children:"Return"})]})}}],[u]);return p?t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("span",{className:"text-red-500",children:["Error: ",p.message]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx(F,{placeholder:"Search assignments...",onChange:e=>A(e.target.value),className:"max-w-md"}),t.jsx(r,{icon:t.jsx(q,{}),onClick:()=>w(),children:"Refresh"})]}),t.jsx(T,{ref:b,columns:D,data:((h=n==null?void 0:n.data)==null?void 0:h.data)||[],loading:y,pagingData:{total:((f=(x=n==null?void 0:n.data)==null?void 0:x.pagination)==null?void 0:f.total)||0,pageIndex:o.page,pageSize:o.limit},onPaginationChange:e=>c(i=>({...i,page:e})),onSelectChange:e=>c({page:1,limit:e})}),t.jsxs(I,{isOpen:s.open,onClose:l,onRequestClose:l,width:400,children:[t.jsx("h4",{className:"mb-4",children:"Return Product"}),s.assignment&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Product"}),t.jsx("p",{className:"font-semibold",children:s.assignment.productName})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Condition"}),t.jsx(M,{value:{value:s.condition,label:s.condition.charAt(0).toUpperCase()+s.condition.slice(1).toLowerCase()},options:[{value:"EXCELLENT",label:"Excellent"},{value:"GOOD",label:"Good"},{value:"FAIR",label:"Fair"},{value:"POOR",label:"Poor"}],onChange:e=>d({...s,condition:e.value})})]}),t.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[t.jsx(r,{variant:"plain",onClick:l,children:"Cancel"}),t.jsx(r,{variant:"solid",onClick:S,loading:g.isLoading,icon:t.jsx(z,{}),children:"Confirm Return"})]})]})]})]})},Re=()=>t.jsxs(E,{className:"h-full",bodyClass:"h-full",children:[t.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:t.jsx("h3",{className:"mb-4 lg:mb-0",children:"Product Assignments"})}),t.jsx(J,{})]});export{Re as default};
