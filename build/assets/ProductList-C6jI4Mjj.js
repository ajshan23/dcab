import{r as n,K as Q,T as ae,j as e}from"./index-cOqvBBIr.js";import{A as ie}from"./AdaptableCard-BVmYyrG9.js";import"./Views-CoZ6zsbe.js";import{B as le}from"./Card-DIGZvD7G.js";import"./chart.config-CfHsf3bG.js";import"./index-C8lJW4Vi.js";import{B as i}from"./Button-DwOByDJ2.js";import{D as G,a as re,t as u,N as p}from"./Upload-DsbizeeT.js";import{D as oe}from"./DataTable-CPwywcbC.js";import{I as H}from"./hoist-non-react-statics.cjs-B9oDFgJF.js";import"./SvgIcon-D-q3lrIO.js";import{S as K}from"./index-CN4Vsls-.js";import{s as ce,t as de,w as me,x as ue,y as pe,v as xe}from"./proxy-CuIDo5Hh.js";import{u as he}from"./useThemeClass-CybD-6cM.js";import{u as $}from"./useQuery-DfbZlmc7.js";import{u as B}from"./useMutation-C6r5hGln.js";import{d as ge}from"./debounce-ENV5vHzm.js";import{a as je,b as fe,c as be}from"./ProductService-JlHD3oXb.js";import{a as ve}from"./EmployeeService.ts-Dnsmk5ht.js";import"./Alert-CTDsJo34.js";import"./index-CBL9JDNu.js";import"./Drawer-u9YseTV0.js";import"./index-BmFHComS.js";import"./index-Dgezmd6G.js";import"./Progress-CRnRERH5.js";import"./ScrollBar-CJQ4FW-3.js";import{M as ye}from"./index-DJ2xx_vj.js";import"./index-Chjiymov.js";import"./toString-R3Kz-oVC.js";import"./CloseButton-DwYxsUt0.js";import"./cloneDeep-DJN0yfLA.js";import"./_getPrototype-DsJNHg3O.js";const Ce=()=>{var M,L,q;const f=n.useRef(null),b=Q(),y=ae(),{textTheme:U}=he(),[C,X]=n.useState(""),[d,v]=n.useState({page:1,limit:10}),[J,N]=n.useState(!1),[V,S]=n.useState(!1),[l,A]=n.useState(null),[r,O]=n.useState(null),[o,P]=n.useState(null),[x,k]=n.useState(null),[w,E]=n.useState(""),[m,R]=n.useState("GOOD"),{data:c,isLoading:W,error:D,refetch:Y}=$({queryKey:["products",d,C],queryFn:()=>be({page:d.page,limit:d.limit,search:C})}),{data:h}=$({queryKey:["employees-for-assignment"],queryFn:()=>ve({page:1,limit:100})}),F=B({mutationFn:je,onSuccess:()=>{u.push(e.jsx(p,{title:"Success",type:"success",children:"Product assigned successfully"})),y.invalidateQueries(["products"]),g()},onError:s=>{var t,a;u.push(e.jsx(p,{title:"Error",type:"danger",children:((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to assign product"}))}}),I=B({mutationFn:s=>fe(s.assignmentId,{condition:s.condition,notes:s.notes}),onSuccess:()=>{u.push(e.jsx(p,{title:"Success",type:"success",children:"Product returned successfully"})),y.invalidateQueries(["products"]),j()},onError:s=>{var t,a;u.push(e.jsx(p,{title:"Error",type:"danger",children:((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to return product"}))}}),Z=n.useMemo(()=>ge(s=>{X(s),v(t=>({...t,page:1}))},500),[]),g=()=>{A(null),P(null),k(null),E(""),N(!1)},j=()=>{O(null),R("GOOD"),S(!1)},_=s=>{A({id:s.id,name:s.name}),N(!0)},ee=s=>{s&&(O({id:s.id,productName:(l==null?void 0:l.name)||"Unknown Product"}),S(!0))},se=async()=>{!l||!o||await F.mutateAsync({productId:l.id,employeeId:o,expectedReturnAt:x==null?void 0:x.toISOString(),notes:w})},te=async()=>{if(!(r!=null&&r.id)){u.push(e.jsx(p,{title:"Error",type:"danger",children:"No valid assignment selected"}));return}await I.mutateAsync({assignmentId:r.id,condition:m,notes:`Returned in ${m.toLowerCase()} condition`})},T=n.useMemo(()=>{var s,t;return((t=(s=h==null?void 0:h.data)==null?void 0:s.data)==null?void 0:t.map(a=>({value:a.id,label:`${a.name} (${a.empId})`})))||[]},[h]),ne=n.useMemo(()=>[{header:"Product",accessorKey:"name",cell:s=>e.jsx("span",{className:"font-semibold",children:s.row.original.name})},{header:"Model",accessorKey:"model"},{header:"Assigned To",cell:s=>{const t=s.row.original.currentAssignment;return t?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:t.employee.name}),e.jsx("span",{className:"text-xs text-gray-500",children:t.employee.empId})]}):"-"}},{header:"Status",cell:s=>{const t=s.row.original.isAssigned;return e.jsx(le,{className:t?"w-fit bg-blue-500 text-white":"w-fit bg-emerald-500 text-white",children:t?"Assigned":"Available"})}},{header:"Actions",id:"action",cell:s=>{const t=s.row.original,a=t.isAssigned,z=t.currentAssignment;return e.jsxs("div",{className:"flex justify-end text-lg gap-2",children:[e.jsx(i,{size:"xs",icon:e.jsx(ce,{}),onClick:()=>b(`/products/view/${t.id}`)}),e.jsx(i,{size:"xs",icon:e.jsx(de,{}),onClick:()=>b(`/products/edit/${t.id}`)}),a?e.jsx(i,{size:"xs",variant:"solid",icon:e.jsx(ye,{}),onClick:()=>z&&ee(z),children:"Return"}):e.jsx(i,{size:"xs",icon:e.jsx(me,{}),onClick:()=>_(t),children:"Assign"})]})}}],[b,U]);return D?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("span",{className:"text-red-500",children:["Error: ",D.message]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(H,{placeholder:"Search products...",onChange:s=>Z(s.target.value),className:"max-w-md"}),e.jsx(i,{icon:e.jsx(ue,{}),onClick:()=>Y(),children:"Refresh"})]}),e.jsx(oe,{ref:f,columns:ne,data:((M=c==null?void 0:c.data)==null?void 0:M.data)||[],loading:W,pagingData:{total:((L=c==null?void 0:c.data)==null?void 0:L.total)||0,pageIndex:d.page,pageSize:d.limit},onPaginationChange:s=>v(t=>({...t,page:s})),onSelectChange:s=>v({page:1,limit:s})}),e.jsxs(G,{isOpen:J,onClose:g,onRequestClose:g,width:500,children:[e.jsx("h4",{className:"mb-4",children:"Assign Product"}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Product"}),e.jsx("p",{className:"font-semibold",children:l.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Employee"}),e.jsx(K,{placeholder:"Select Employee",options:T,value:o?{value:o,label:(q=T.find(s=>s.value===o))==null?void 0:q.label}:null,onChange:s=>P(s==null?void 0:s.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Expected Return Date (Optional)"}),e.jsx(re,{placeholder:"Select date",value:x,onChange:s=>k(s)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notes (Optional)"}),e.jsx(H,{type:"text",value:w,onChange:s=>E(s.target.value),placeholder:"Additional notes"})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(i,{variant:"plain",onClick:g,children:"Cancel"}),e.jsx(i,{variant:"solid",onClick:se,loading:F.isLoading,disabled:!o,children:"Confirm Assignment"})]})]})]}),e.jsxs(G,{isOpen:V,onClose:j,onRequestClose:j,width:400,children:[e.jsx("h4",{className:"mb-4",children:"Return Product"}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Product"}),e.jsx("p",{className:"font-semibold",children:r.productName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Condition"}),e.jsx(K,{value:{value:m,label:m.charAt(0).toUpperCase()+m.slice(1).toLowerCase()},options:[{value:"EXCELLENT",label:"Excellent"},{value:"GOOD",label:"Good"},{value:"FAIR",label:"Fair"},{value:"POOR",label:"Poor"}],onChange:s=>R(s.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(i,{variant:"plain",onClick:j,children:"Cancel"}),e.jsx(i,{variant:"solid",onClick:te,loading:I.isLoading,icon:e.jsx(pe,{}),children:"Confirm Return"})]})]})]})]})},Ne=()=>{const f=Q();return e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:e.jsx(i,{variant:"solid",size:"sm",icon:e.jsx(xe,{}),onClick:()=>f("/products/create"),children:"Add Product"})})},ts=()=>e.jsxs(ie,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Products"}),e.jsx(Ne,{})]}),e.jsx(Ce,{})]});export{ts as default};
