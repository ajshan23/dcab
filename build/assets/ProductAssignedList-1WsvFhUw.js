import{r as a,K as le,T as oe,j as e}from"./index-BTvfn8c6.js";import{A as re}from"./AdaptableCard-BpOmVb2l.js";import"./Views-CJ6KUMaV.js";import{B as ce}from"./Badge-BvMIftRM.js";import"./chart.config-DAFIsZQa.js";import"./index-DrMltTCj.js";import{B as i}from"./Button-ZOmEEmWf.js";import{t as h,N as x,D as K,a as de}from"./Upload-B5EJ-QdQ.js";import{D as ue,S as $}from"./DataTable-6RCwsUpc.js";import{I as B}from"./hoist-non-react-statics.cjs-7QXkVKXm.js";import"./SvgIcon-DQO28BJW.js";import{s as me,t as pe,w as he,x as xe,y as ge}from"./proxy-yAAJyhxI.js";import{u as je}from"./useThemeClass-BfVIhGrM.js";import{u as Q}from"./useQuery-DgMmMGS9.js";import{u as U}from"./useMutation-B3D-2MId.js";import{d as fe}from"./debounce-DTfKDCYg.js";import{a as be,b as ve,h as ye}from"./ProductService-BoDmucCl.js";import{a as Ce}from"./EmployeeService.ts-kyrxpDij.js";import"./Alert-vY0LSn8E.js";import"./index-B8ZftT__.js";import"./Drawer-BB0eFAGt.js";import"./index-DLYq64dO.js";import"./index-CYej4EnW.js";import"./Progress-DNVzeDE3.js";import"./ScrollBar-D7_TsneS.js";import{M as Ne}from"./index-C0LSWwfl.js";import"./index-Chjiymov.js";import"./toString-BZKBz3l6.js";import"./CloseButton-q8NuGXO0.js";import"./cloneDeep-DJN0yfLA.js";import"./_getPrototype-BSvN2cSG.js";const Se=()=>{var T,q,z;const X=a.useRef(null),y=le(),N=oe(),{textTheme:J}=je(),[S,V]=a.useState(""),[u,C]=a.useState({page:1,limit:10}),[W,A]=a.useState(!1),[Y,O]=a.useState(!1),[g,E]=a.useState(null),[o,P]=a.useState(null),[r,k]=a.useState(null),[j,w]=a.useState(null),[R,D]=a.useState(""),[m,I]=a.useState("GOOD"),{data:c,isLoading:Z,error:F,refetch:_}=Q({queryKey:["products",u,S],queryFn:()=>ye({page:u.page,limit:u.limit,search:S,includeAssignments:!0})}),{data:f}=Q({queryKey:["employees-for-assignment"],queryFn:()=>Ce({page:1,limit:100})}),M=U({mutationFn:be,onSuccess:()=>{h.push(e.jsx(x,{title:"Success",type:"success",children:"Product assigned successfully"})),N.invalidateQueries(["products"]),b()},onError:s=>{var t,n;h.push(e.jsx(x,{title:"Error",type:"danger",children:((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to assign product"}))}}),G=U({mutationFn:s=>ve(s.assignmentId,{condition:s.condition,notes:s.notes}),onSuccess:()=>{h.push(e.jsx(x,{title:"Success",type:"success",children:"Product returned successfully"})),N.invalidateQueries(["products"]),v()},onError:s=>{var t,n;h.push(e.jsx(x,{title:"Error",type:"danger",children:((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to return product"}))}}),ee=a.useMemo(()=>fe(s=>{V(s),C(t=>({...t,page:1}))},500),[]),b=()=>{E(null),k(null),w(null),D(""),A(!1)},v=()=>{P(null),I("GOOD"),O(!1)},se=s=>{E({id:s.id,name:s.name}),A(!0)},te=s=>{var t;P({id:s.id,productName:((t=s.product)==null?void 0:t.name)||"Unknown Product"}),O(!0)},ne=async()=>{!g||!r||await M.mutateAsync({productId:g.id,employeeId:r,expectedReturnAt:j==null?void 0:j.toISOString(),notes:R})},ae=async()=>{if(!(o!=null&&o.id)){h.push(e.jsx(x,{title:"Error",type:"danger",children:"No valid assignment selected"}));return}await G.mutateAsync({assignmentId:o.id,condition:m,notes:`Returned in ${m.toLowerCase()} condition`})},L=a.useMemo(()=>{var s,t;return((t=(s=f==null?void 0:f.data)==null?void 0:s.data)==null?void 0:t.map(n=>({value:n.id,label:`${n.name} (${n.empId})`})))||[]},[f]),ie=a.useMemo(()=>[{header:"Product",accessorKey:"name",cell:s=>e.jsx("span",{className:"font-semibold",children:s.row.original.name})},{header:"Model",accessorKey:"model"},{header:"Status",cell:s=>{var d,l;const n=(l=(d=s.row.original.assignments)==null?void 0:d.some)==null?void 0:l.call(d,p=>p.status==="ASSIGNED"&&!p.returnedAt);return e.jsx(ce,{className:n?"w-fit bg-blue-500 text-white":"w-fit bg-emerald-500 text-white",children:n?"Assigned":"Available"})}},{header:"Actions",id:"action",cell:s=>{var l,p;const t=s.row.original,n=(p=(l=t.assignments)==null?void 0:l.find)==null?void 0:p.call(l,H=>H.status==="ASSIGNED"&&!H.returnedAt),d=!!n;return e.jsxs("div",{className:"flex justify-end text-lg gap-2",children:[e.jsx(i,{size:"xs",icon:e.jsx(me,{}),onClick:()=>y(`/products/view/${t.id}`)}),e.jsx(i,{size:"xs",icon:e.jsx(pe,{}),onClick:()=>y(`/products/edit/${t.id}`)}),d?e.jsx(i,{size:"xs",variant:"solid",icon:e.jsx(Ne,{}),onClick:()=>te(n),children:"Return"}):e.jsx(i,{size:"xs",icon:e.jsx(he,{}),onClick:()=>se(t),children:"Assign"})]})}}],[y,J]);return F?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("span",{className:"text-red-500",children:["Error: ",F.message]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(B,{placeholder:"Search products...",onChange:s=>ee(s.target.value),className:"max-w-md"}),e.jsx(i,{icon:e.jsx(xe,{}),onClick:()=>_(),children:"Refresh"})]}),e.jsx(ue,{ref:X,columns:ie,data:((T=c==null?void 0:c.data)==null?void 0:T.data)||[],loading:Z,pagingData:{total:((q=c==null?void 0:c.data)==null?void 0:q.total)||0,pageIndex:u.page,pageSize:u.limit},onPaginationChange:s=>C(t=>({...t,page:s})),onSelectChange:s=>C({page:1,limit:s})}),e.jsxs(K,{isOpen:W,onClose:b,onRequestClose:b,width:500,children:[e.jsx("h4",{className:"mb-4",children:"Assign Product"}),g&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Product"}),e.jsx("p",{className:"font-semibold",children:g.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Employee"}),e.jsx($,{placeholder:"Select Employee",options:L,value:r?{value:r,label:(z=L.find(s=>s.value===r))==null?void 0:z.label}:null,onChange:s=>k(s==null?void 0:s.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Expected Return Date (Optional)"}),e.jsx(de,{placeholder:"Select date",value:j,onChange:s=>w(s)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notes (Optional)"}),e.jsx(B,{type:"text",value:R,onChange:s=>D(s.target.value),placeholder:"Additional notes"})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(i,{variant:"plain",onClick:b,children:"Cancel"}),e.jsx(i,{variant:"solid",onClick:ne,loading:M.isLoading,disabled:!r,children:"Confirm Assignment"})]})]})]}),e.jsxs(K,{isOpen:Y,onClose:v,onRequestClose:v,width:400,children:[e.jsx("h4",{className:"mb-4",children:"Return Product"}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Product"}),e.jsx("p",{className:"font-semibold",children:o.productName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Condition"}),e.jsx($,{value:{value:m,label:m.charAt(0).toUpperCase()+m.slice(1).toLowerCase()},options:[{value:"EXCELLENT",label:"Excellent"},{value:"GOOD",label:"Good"},{value:"FAIR",label:"Fair"},{value:"POOR",label:"Poor"}],onChange:s=>I(s.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(i,{variant:"plain",onClick:v,children:"Cancel"}),e.jsx(i,{variant:"solid",onClick:ae,loading:G.isLoading,icon:e.jsx(ge,{}),children:"Confirm Return"})]})]})]})]})},ts=()=>e.jsxs(re,{className:"h-full",bodyClass:"h-full",children:[e.jsx("div",{className:"lg:flex items-center justify-between mb-4",children:e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Product Assignments"})}),e.jsx(Se,{})]});export{ts as default};
