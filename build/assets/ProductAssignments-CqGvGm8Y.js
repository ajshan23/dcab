import{j as e,r as y,T as G,V as K,K as E}from"./index-CpoNZy_K.js";import{A as H}from"./AdaptableCard-BrRUUEaN.js";import"./Views-Dk2fMzxD.js";import{S,B as L,D as Q,T as Y}from"./DataTable-Dd0ah6Zu.js";import"./SvgIcon-CF7LUJah.js";import{p as F,l as z,n as O,t as U}from"./index-U2oPHaYB.js";import"./index-DnNRFRxm.js";import{B as j}from"./Button-5FPMlk4P.js";import{t as C,N as I}from"./Upload-BWEhbG-n.js";import{I as P}from"./hoist-non-react-statics.cjs-CSsTDRi9.js";import{u as J}from"./useThemeClass-BqZMVik2.js";import{u as N}from"./useQuery-CdU9hP8Y.js";import{u as W}from"./useMutation-CVmbNRHT.js";import{a as X,b as Z,c as _}from"./productAssignmentService-rhs2HyLo.js";import{F as M,a as p}from"./Alert-DmmJ-CO8.js";import{F as $,c as D,a as R,b as v,d as b,e as w,f as ee}from"./index.esm-CUjMKeau.js";import{C as q}from"./index-DcKY4__E.js";import"./Drawer-YiESGu5W.js";import"./index-2_f4dh3X.js";import"./index-UDOHiYwi.js";import"./ScrollBar-Bxslmpi8.js";import{d as se,i as ae}from"./ProductService-X_fYFXrO.js";import{a as T}from"./EmployeeService.ts-DIGrsvEt.js";import"./cloneDeep-DgnTTuDI.js";import"./index-1G6_mNEt.js";import"./CloseButton-CrGnf40L.js";import"./toString-BjSMy3v_.js";import"./_getPrototype-DwJTGY_5.js";const te=D().shape({productId:b().required("Product is required"),employeeId:b().required("Employee is required"),quantity:w().required().min(1),notes:b().max(500,"Notes too long"),status:b().required("Status is required"),condition:b().when("status",{is:"returned",then:b().required("Condition is required for returns")})}),k=({onSubmit:o,onCancel:i,initialValues:n={productId:"",employeeId:"",quantity:1,notes:"",status:"assigned",condition:""}})=>{const{data:d}=N(["products-select"],()=>se({limit:1e3}).then(s=>s.data)),{data:u}=N(["employees-select"],()=>T({limit:1e3}).then(s=>s.data));return e.jsx($,{initialValues:n,validationSchema:te,onSubmit:o,children:({touched:s,errors:t,isSubmitting:x,values:m,setFieldValue:g})=>e.jsx(R,{children:e.jsxs(M,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(p,{label:"Product",invalid:!!t.productId&&s.productId,errorMessage:t.productId,children:e.jsx(v,{name:"productId",children:({field:r,form:c})=>e.jsx(S,{placeholder:"Select Product",options:(d==null?void 0:d.map(a=>({value:a.id,label:`${a.name} (${a.serialNumber}) - Stock: ${a.availableStock}/${a.totalStock}`})))||[],value:d==null?void 0:d.find(a=>a.id===r.value),onChange:a=>c.setFieldValue(r.name,a==null?void 0:a.value),isDisabled:n.productId!==""})})}),e.jsx(p,{label:"Employee",invalid:!!t.employeeId&&s.employeeId,errorMessage:t.employeeId,children:e.jsx(v,{name:"employeeId",children:({field:r,form:c})=>e.jsx(S,{placeholder:"Select Employee",options:(u==null?void 0:u.map(a=>({value:a.id,label:`${a.name} (${a.empId})`})))||[],value:u==null?void 0:u.find(a=>a.id===r.value),onChange:a=>c.setFieldValue(r.name,a==null?void 0:a.value)})})}),e.jsx(p,{label:"Quantity",invalid:!!t.quantity&&s.quantity,errorMessage:t.quantity,children:e.jsx(v,{type:"number",name:"quantity",component:P,min:1})}),e.jsx(p,{label:"Status",invalid:!!t.status&&s.status,errorMessage:t.status,children:e.jsx(v,{name:"status",children:({field:r,form:c})=>e.jsx(S,{placeholder:"Select Status",options:[{value:"assigned",label:"Assigned"},{value:"returned",label:"Returned"},{value:"lost",label:"Lost"},{value:"damaged",label:"Damaged"}],value:r.value,onChange:a=>c.setFieldValue(r.name,a==null?void 0:a.value)})})}),m.status==="returned"&&e.jsx(p,{label:"Condition",invalid:!!t.condition&&s.condition,errorMessage:t.condition,children:e.jsx(v,{name:"condition",children:({field:r,form:c})=>e.jsx(S,{placeholder:"Select Condition",options:[{value:"excellent",label:"Excellent"},{value:"good",label:"Good"},{value:"fair",label:"Fair"},{value:"poor",label:"Poor"}],value:r.value,onChange:a=>c.setFieldValue(r.name,a==null?void 0:a.value)})})}),e.jsx(p,{label:"Notes",invalid:!!t.notes&&s.notes,errorMessage:t.notes,children:e.jsx(v,{as:"textarea",name:"notes",placeholder:"Assignment notes",component:P,textArea:!0})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(j,{type:"button",onClick:i,icon:e.jsx(F,{}),children:"Cancel"}),e.jsx(j,{variant:"solid",type:"submit",loading:x,children:n.id?"Update Assignment":"Assign Product"})]})]})})})},le=()=>{const o=y.useRef(null),{textTheme:i}=J(),n=G(),[d,u]=y.useState(!1),[s,t]=y.useState(null),[x,m]=y.useState(null),{data:g,isLoading:r,error:c,refetch:a}=N({queryKey:["product-assignments"],queryFn:Z}),h=W({mutationFn:l=>X(l.toString()),onSuccess:()=>{C.push(e.jsx(I,{title:"Success",type:"success",children:"Product returned successfully"})),n.invalidateQueries(["product-assignments"]),m(null)},onError:l=>{var f,A;C.push(e.jsx(I,{title:"Error",type:"danger",children:((A=(f=l.response)==null?void 0:f.data)==null?void 0:A.message)||"Failed to return product"}))}}),B=async l=>{await h.mutateAsync(l)},V=y.useMemo(()=>[{header:"Product",accessorKey:"product",cell:l=>e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:l.row.original.product.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["SN: ",l.row.original.product.serialNumber," | Stock: ",l.row.original.product.availableStock,"/",l.row.original.product.totalStock]})]})},{header:"Assigned To",accessorKey:"employee",cell:l=>e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:l.row.original.employee.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",l.row.original.employee.empId]})]})},{header:"Assigned On",accessorKey:"assignedDate",cell:l=>e.jsxs("div",{children:[e.jsx("span",{children:K(l.row.original.assignedDate).format("DD/MM/YYYY")}),e.jsxs("div",{className:"text-xs text-gray-500",children:["by ",l.row.original.assignedBy.username]})]})},{header:"Status",accessorKey:"status",cell:l=>{const f=l.row.original.status,A={assigned:"bg-blue-500",returned:"bg-emerald-500",lost:"bg-red-500",damaged:"bg-amber-500"};return e.jsx(L,{className:A[f],children:f})}},{header:"Actions",id:"action",cell:l=>e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("span",{className:`cursor-pointer p-2 hover:${i}`,onClick:()=>t(l.row.original),children:e.jsx(z,{className:"text-xl"})}),l.row.original.status==="assigned"&&e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:()=>m(l.row.original.id),children:e.jsx(F,{className:"text-xl"})})]})}],[i]);return c?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("span",{className:"text-red-500",children:["Error: ",c.message]})}):e.jsx(e.Fragment,{children:d?e.jsx(k,{onSubmit:async l=>{u(!1)},onCancel:()=>u(!1)}):s?e.jsx(k,{initialValues:{...s,productId:s.product.id,employeeId:s.employee.id},onSubmit:async l=>{t(null)},onCancel:()=>t(null)}):x?e.jsxs("div",{className:"p-4 border rounded-lg bg-white shadow-sm",children:[e.jsx("h4",{className:"mb-4",children:"Confirm Return"}),e.jsx("p",{className:"mb-4",children:"Are you sure you want to return this product?"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{variant:"plain",onClick:()=>m(null),children:"Cancel"}),e.jsx(j,{variant:"solid",color:"red",loading:h.isLoading,onClick:()=>B(x),children:"Confirm Return"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{children:"Active Assignments"}),e.jsx(j,{variant:"solid",size:"sm",onClick:()=>u(!0),children:"New Assignment"})]}),e.jsx(Q,{ref:o,columns:V,data:(g==null?void 0:g.data)||[],loading:r})]})})},ie=({products:o,selectedIds:i,onSelectionChange:n})=>{const d=s=>{const t=i.includes(s)?i.filter(x=>x!==s):[...i,s];n(t)},u=()=>{i.length===o.length?n([]):n(o.map(s=>s.id))};return e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(Y,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:50},children:e.jsx(q,{checked:i.length===o.length&&o.length>0,indeterminate:i.length>0&&i.length<o.length,onChange:u})}),e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Model"}),e.jsx("th",{children:"Serial Number"}),e.jsx("th",{children:"Available Stock"})]})}),e.jsxs("tbody",{children:[o.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(q,{checked:i.includes(s.id),onChange:()=>d(s.id),disabled:s.availableStock<=0})}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.model}),e.jsx("td",{children:s.serialNumber}),e.jsx("td",{children:e.jsx("span",{className:s.availableStock>0?"text-emerald-500":"text-red-500",children:s.availableStock})})]},s.id)),o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-4 text-gray-500",children:"No available products found"})})]})]})})},ne=D().shape({employeeId:w().required("Employee is required"),productIds:ee().of(w()).min(1,"Select at least one product")}),re=({onSubmit:o,onCancel:i})=>{const n=E(),{data:d}=N(["employees-select"],()=>T({limit:1e3}).then(t=>t.data.data)),{data:u}=N(["available-products"],()=>ae().then(t=>t.data.data)),s=async(t,{setSubmitting:x})=>{var m,g;try{(await _(t)).data.success&&(C.push(e.jsxs(I,{title:"Success",type:"success",children:[t.productIds.length," products assigned successfully"]})),o&&o(),n("/product-assignments"))}catch(r){C.push(e.jsx(I,{title:"Error",type:"danger",children:((g=(m=r.response)==null?void 0:m.data)==null?void 0:g.message)||"Failed to assign products"}))}finally{x(!1)}};return e.jsx($,{initialValues:{employeeId:"",productIds:[]},validationSchema:ne,onSubmit:s,children:({values:t,touched:x,errors:m,isSubmitting:g,setFieldValue:r})=>e.jsx(R,{children:e.jsxs(M,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(p,{label:"Employee",invalid:!!m.employeeId&&x.employeeId,errorMessage:m.employeeId,children:e.jsx(v,{name:"employeeId",children:({field:c,form:a})=>e.jsx(S,{placeholder:"Select Employee",options:(d==null?void 0:d.map(h=>({value:h.id,label:`${h.name} (${h.empId})`})))||[],value:d==null?void 0:d.find(h=>h.id===c.value),onChange:h=>a.setFieldValue(c.name,h==null?void 0:h.value)})})}),e.jsx(p,{label:"Products to Assign",invalid:!!m.productIds&&x.productIds,errorMessage:m.productIds,children:e.jsx(ie,{products:u||[],selectedIds:t.productIds,onSelectionChange:c=>r("productIds",c)})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(j,{type:"button",onClick:i,icon:e.jsx(F,{}),children:"Cancel"}),e.jsxs(j,{variant:"solid",type:"submit",loading:g,children:["Assign ",t.productIds.length," Products"]})]})]})})})},Re=()=>{const o=E(),[i,n]=y.useState("list");return e.jsxs(H,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Product Assignments"}),i==="list"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"solid",size:"sm",icon:e.jsx(O,{}),onClick:()=>n("assign"),children:"Assign Product"}),e.jsx(j,{variant:"solid",size:"sm",icon:e.jsx(U,{}),onClick:()=>n("bulk"),children:"Bulk Assign"})]})]}),i==="list"&&e.jsx(le,{}),i==="assign"&&e.jsx(k,{onSubmit:()=>{n("list"),o("/product-assignments")},onCancel:()=>n("list")}),i==="bulk"&&e.jsx(re,{onSubmit:()=>n("list"),onCancel:()=>n("list")})]})};export{Re as default};
