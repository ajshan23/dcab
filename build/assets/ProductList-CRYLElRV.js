import{r as a,K as J,T as oe,j as e}from"./index-BTvfn8c6.js";import{A as re}from"./AdaptableCard-BpOmVb2l.js";import"./Views-CJ6KUMaV.js";import{B as ce}from"./Badge-BvMIftRM.js";import"./chart.config-DAFIsZQa.js";import"./index-DrMltTCj.js";import{B as i}from"./Button-ZOmEEmWf.js";import{D as $,a as de,t as x,N as h}from"./Upload-B5EJ-QdQ.js";import{D as ue,S as B}from"./DataTable-6RCwsUpc.js";import{I as Q}from"./hoist-non-react-statics.cjs-7QXkVKXm.js";import"./SvgIcon-DQO28BJW.js";import{s as me,t as pe,w as xe,x as he,y as ge,v as je}from"./proxy-yAAJyhxI.js";import{u as fe}from"./useThemeClass-BfVIhGrM.js";import{u as U}from"./useQuery-DgMmMGS9.js";import{u as X}from"./useMutation-B3D-2MId.js";import{d as be}from"./debounce-DTfKDCYg.js";import{a as ve,b as Ce,c as ye}from"./ProductService-BoDmucCl.js";import{a as Ne}from"./EmployeeService.ts-kyrxpDij.js";import"./Alert-vY0LSn8E.js";import"./index-B8ZftT__.js";import"./Drawer-BB0eFAGt.js";import"./index-DLYq64dO.js";import"./index-CYej4EnW.js";import"./Progress-DNVzeDE3.js";import"./ScrollBar-D7_TsneS.js";import{M as Se}from"./index-C0LSWwfl.js";import"./index-Chjiymov.js";import"./toString-BZKBz3l6.js";import"./CloseButton-q8NuGXO0.js";import"./cloneDeep-DJN0yfLA.js";import"./_getPrototype-BSvN2cSG.js";const Ae=()=>{var q,z,H;const C=a.useRef(null),y=J(),S=oe(),{textTheme:V}=fe(),[A,W]=a.useState(""),[u,N]=a.useState({page:1,limit:10}),[Y,P]=a.useState(!1),[Z,O]=a.useState(!1),[g,E]=a.useState(null),[o,k]=a.useState(null),[r,w]=a.useState(null),[j,R]=a.useState(null),[D,I]=a.useState(""),[m,F]=a.useState("GOOD"),{data:c,isLoading:_,error:T,refetch:ee}=U({queryKey:["products",u,A],queryFn:()=>ye({page:u.page,limit:u.limit,search:A,includeAssignments:!0})}),{data:f}=U({queryKey:["employees-for-assignment"],queryFn:()=>Ne({page:1,limit:100})}),M=X({mutationFn:ve,onSuccess:()=>{x.push(e.jsx(h,{title:"Success",type:"success",children:"Product assigned successfully"})),S.invalidateQueries(["products"]),b()},onError:s=>{var t,n;x.push(e.jsx(h,{title:"Error",type:"danger",children:((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to assign product"}))}}),G=X({mutationFn:s=>Ce(s.assignmentId,{condition:s.condition,notes:s.notes}),onSuccess:()=>{x.push(e.jsx(h,{title:"Success",type:"success",children:"Product returned successfully"})),S.invalidateQueries(["products"]),v()},onError:s=>{var t,n;x.push(e.jsx(h,{title:"Error",type:"danger",children:((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to return product"}))}}),se=a.useMemo(()=>be(s=>{W(s),N(t=>({...t,page:1}))},500),[]),b=()=>{E(null),w(null),R(null),I(""),P(!1)},v=()=>{k(null),F("GOOD"),O(!1)},te=s=>{E({id:s.id,name:s.name}),P(!0)},ne=s=>{var t;k({id:s.id,productName:((t=s.product)==null?void 0:t.name)||"Unknown Product"}),O(!0)},ae=async()=>{!g||!r||await M.mutateAsync({productId:g.id,employeeId:r,expectedReturnAt:j==null?void 0:j.toISOString(),notes:D})},ie=async()=>{if(!(o!=null&&o.id)){x.push(e.jsx(h,{title:"Error",type:"danger",children:"No valid assignment selected"}));return}await G.mutateAsync({assignmentId:o.id,condition:m,notes:`Returned in ${m.toLowerCase()} condition`})},L=a.useMemo(()=>{var s,t;return((t=(s=f==null?void 0:f.data)==null?void 0:s.data)==null?void 0:t.map(n=>({value:n.id,label:`${n.name} (${n.empId})`})))||[]},[f]),le=a.useMemo(()=>[{header:"Product",accessorKey:"name",cell:s=>e.jsx("span",{className:"font-semibold",children:s.row.original.name})},{header:"Model",accessorKey:"model"},{header:"Status",cell:s=>{var d,l;const n=(l=(d=s.row.original.assignments)==null?void 0:d.some)==null?void 0:l.call(d,p=>p.status==="ASSIGNED"&&!p.returnedAt);return e.jsx(ce,{className:n?"w-fit bg-blue-500 text-white":"w-fit bg-emerald-500 text-white",children:n?"Assigned":"Available"})}},{header:"Actions",id:"action",cell:s=>{var l,p;const t=s.row.original,n=(p=(l=t.assignments)==null?void 0:l.find)==null?void 0:p.call(l,K=>K.status==="ASSIGNED"&&!K.returnedAt),d=!!n;return e.jsxs("div",{className:"flex justify-end text-lg gap-2",children:[e.jsx(i,{size:"xs",icon:e.jsx(me,{}),onClick:()=>y(`/products/view/${t.id}`)}),e.jsx(i,{size:"xs",icon:e.jsx(pe,{}),onClick:()=>y(`/products/edit/${t.id}`)}),d?e.jsx(i,{size:"xs",variant:"solid",icon:e.jsx(Se,{}),onClick:()=>ne(n),children:"Return"}):e.jsx(i,{size:"xs",icon:e.jsx(xe,{}),onClick:()=>te(t),children:"Assign"})]})}}],[y,V]);return T?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("span",{className:"text-red-500",children:["Error: ",T.message]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(Q,{placeholder:"Search products...",onChange:s=>se(s.target.value),className:"max-w-md"}),e.jsx(i,{icon:e.jsx(he,{}),onClick:()=>ee(),children:"Refresh"})]}),e.jsx(ue,{ref:C,columns:le,data:((q=c==null?void 0:c.data)==null?void 0:q.data)||[],loading:_,pagingData:{total:((z=c==null?void 0:c.data)==null?void 0:z.total)||0,pageIndex:u.page,pageSize:u.limit},onPaginationChange:s=>N(t=>({...t,page:s})),onSelectChange:s=>N({page:1,limit:s})}),e.jsxs($,{isOpen:Y,onClose:b,onRequestClose:b,width:500,children:[e.jsx("h4",{className:"mb-4",children:"Assign Product"}),g&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Product"}),e.jsx("p",{className:"font-semibold",children:g.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Employee"}),e.jsx(B,{placeholder:"Select Employee",options:L,value:r?{value:r,label:(H=L.find(s=>s.value===r))==null?void 0:H.label}:null,onChange:s=>w(s==null?void 0:s.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Expected Return Date (Optional)"}),e.jsx(de,{placeholder:"Select date",value:j,onChange:s=>R(s)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notes (Optional)"}),e.jsx(Q,{type:"text",value:D,onChange:s=>I(s.target.value),placeholder:"Additional notes"})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(i,{variant:"plain",onClick:b,children:"Cancel"}),e.jsx(i,{variant:"solid",onClick:ae,loading:M.isLoading,disabled:!r,children:"Confirm Assignment"})]})]})]}),e.jsxs($,{isOpen:Z,onClose:v,onRequestClose:v,width:400,children:[e.jsx("h4",{className:"mb-4",children:"Return Product"}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Product"}),e.jsx("p",{className:"font-semibold",children:o.productName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Condition"}),e.jsx(B,{value:{value:m,label:m.charAt(0).toUpperCase()+m.slice(1).toLowerCase()},options:[{value:"EXCELLENT",label:"Excellent"},{value:"GOOD",label:"Good"},{value:"FAIR",label:"Fair"},{value:"POOR",label:"Poor"}],onChange:s=>F(s.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(i,{variant:"plain",onClick:v,children:"Cancel"}),e.jsx(i,{variant:"solid",onClick:ie,loading:G.isLoading,icon:e.jsx(ge,{}),children:"Confirm Return"})]})]})]})]})},Pe=()=>{const C=J();return e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:e.jsx(i,{variant:"solid",size:"sm",icon:e.jsx(je,{}),onClick:()=>C("/products/create"),children:"Add Product"})})},as=()=>e.jsxs(re,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Products"}),e.jsx(Pe,{})]}),e.jsx(Ae,{})]});export{as as default};
